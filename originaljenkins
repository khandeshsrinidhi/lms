pipeline {
    agent any
    environment {
    dockerhub=credentials('docker-hub1')
    }
    

        

        
        
        stage('docker building...'){
            steps{
                sh 'cd api && docker build -t srinidhi3108/api .'
                sh 'cd webapp && docker build -t srinidhi3108/webapp .'
            }
        }
        stage('Docker Login'){
            steps{
                echo 'Docker login'
                sh 'echo $dockerhub_PSW | docker login -u $dockerhub_USR --password-stdin'
            }
        }
        stage('Docker Push'){
            steps{
                echo 'docker push'
                sh 'docker push srinidhi3108/api'
                sh 'docker push srinidhi3108/webapp'
            }
        }
        stage('docker rm old files'){
            steps{
                echo 'removing old files'
                sh 'docker rmi -f srinidhi3108/api'
                sh 'docker rmi -f srinidhi3108/webapp'
            }
        }
        stage('K8s Deployment'){
            steps{
                /*sh 'echo deploying database'
                sh 'cd k8s && kubectl apply -f db-deployment.yml'
                sh 'cd k8s && kubectl apply -f db-cluster-ip-service.yml'
                sh 'cd k8s && kubectl apply -f database-persistent-volume-claim.yml'*/


                sh 'echo deploying backend'
                sh 'cd k8s && kubectl apply -f api-deployment.yml'
                sh 'cd k8s && kubectl apply -f api-lb-service.yml'


                sh 'echo deploying frontend'
                sh 'cd k8s && kubectl apply -f web-deployment.yml'
                sh 'cd k8s && kubectl apply -f web-lb-service.yml'

            }
        }


    

  
  
       

    
        
 
    
        
            
                
                    
                        
    }
}
         





        
    

